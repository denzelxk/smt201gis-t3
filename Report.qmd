# Methodology

## 3.3 Population Density Analysis

#### 3.3.1 Deriving buildings with Derna City

At this stage, we need to analyse the building layer given and only select buildings that fall within the Derna city area.

-   Navigate to: Vector \> Research Tools \> Select by Location...

    -   For the input fields

        -   Select features from: gis_osm_buildings_a_free_1

        -   Where the features (geometric predicate): intersect

        -   By comparing to the features from: Derna_city_250m_hexagon

            -   Advanced option:

                -   Invalid feature filtering: Do not Filter (Better Performance)

3.3_select_location

-   Click "Run"

We will now save only the selected features within our study area for use.

-   Navigate to: Layers Sidebar \> Right click "gis_osm_buildings_a_free_1" \> Export \> Save Selected Features As...

    -   For the input fields

        -   Format: GeoPackage

        -   File name:

            -   Name the file "Derna"

            -   Save the file in "GeoPackage"

        -   Layer Name: Buildings

        -   CRS: EPSG:3197

![](https://lh7-us.googleusercontent.com/4oPaAayJdFA4Y_-1DO0MuqgKzl_CCsIv0ObbcGvMkQLFEWFEW8dy4V5whipM5foKdCrab6VwGGtGk-QLv1DGivpdi-zW_8jDb75MaNPq6FXpj3iU19RLcYTh4TMkDBiBP_Xe-CG1zV9bTlEGm6sCRW8)

-   Click on "Ok"

-   Remove "gis_osm_buildings_a_free_1" layer

#### 3.3.2 Identifying residential/apartment buildings

\

At this stage, we need to identify the residential and apartment buildings in Derna as well as classify those buildings that are unclassified into the above-mentioned buildings based on area size.

-   Navigate to: Layers Sidebar \> Right click "Derna - Buildings" \> Open Attribute Table

-   From the Attribute Table:

    -   Click on "Select features using an expression" 

    -   For the input fields:

        -   Expression box: "type"  =  'apartments' or  "type"  =  'residential'

![](https://lh7-us.googleusercontent.com/9GG1Amfom_IuPEtnpvOJVLP8NrLcpvlxDZV8UOLUil6JZ_p5wJhGJo3rPEK1yA5oIryTRSHYgTzYlmqCI3uEb8eQMA-N7lhIjSUn7RZeSOIRsIbf41K5iv5F8Gz_JFzlpSie3fj_nbLWAo5VHPd1JM4)

-   Click on "Select Features"

-   Following the steps shown previously, save the selected features as a GeoPackage in the "Derna" GeoPackage and name it "Residential_Apartment_Buildings". 

\

-   Navigate to: Layers Sidebar \> Right click "Residential_Apartment_Buildings" \> Open Attribute Table

-   From the Attribute Table:

    -   Click on "Open field calculator" ![](https://lh7-us.googleusercontent.com/CaBe2Z_ZimjieWmZ9wxXEgbml7U_vOIt_DyKaQ7iLclWp6DdSNzLg8tClkkoK2e_R34kMjU6oQiePnmMiwwdYz89OcZuJenK64u6AjvwRpV-CPxWdFLWz1H4dvb0W_sbUJJk_h6ihN8YLaBCDgEggZs)

        -   For the input fields:

            -   Output field name: Area

            -   Output field type: Decimal number (real)

            -   Expression box: \$area

![](https://lh7-us.googleusercontent.com/MWeRQrVd7lpFaLE1JiZHaoDd45KDwxSZ9edDgwqoCArGwIw6Wen6iW5Mzb4K7-KypwR4-5V15yqbU4VhsCPjVWOzkQPl20rBxQ2Rz8eCMa17oOAiyEciwNkQhAOtdgfR_QfeigRk01KI5X5jYRaW39w)

-   Click on "Ok"

<!-- -->

-   Click on "Toggle edits" ![](https://lh7-us.googleusercontent.com/KPtfo_uvtaj9tF3Plpjs2IjfSelKYC0qgA6I42FzdCKLDtbmU5qRVbVDN-q3iYtUK69LnwVJ5ihHnXDrKfw0j9GvQyTk5EQKf79JBMc1sAH2_FCqKG3PKneGMRvgFMdZZ2W-Kc4X2aA-JWqCKcweJUY)

    -   Save the changes made\
        \
        \

<!-- -->

-   Take note of the "area" value of a apartment block, in this case, the building with fid of 4094

![](https://lh7-us.googleusercontent.com/pjuxti08loBqW705eCOs1yiOUcbYJ-A6pqDqEhPi2mpvYR3gnfqOUzXMngTlkFa-jC53BxNeNXJUcJqG-5kNRdTLpMDltbh_9vU-kvvZg_65SU5rFv9c14_ae9v6fCpKN38sjgQ4EE8XC4l-HSdRHVo)

-   Navigate to: Layers Sidebar \> Right click "Derna - Buildings" \> Open Attribute Table

-   From the Attribute Table:

    -   Click on "Select features using an expression" 

    -   For the input fields:

        -   Expression box: \$area \<= 416.96021051961

        -   Number is from the area of the residential area we found previously.

-   Following the steps shown previously, save the selected features as a GeoPackage in the "Derna" GeoPackage and name it "population_buildings". 

-   Remove "Derna --- Residential_Apartment_Buildings" and "Derna --- Buildings" layers.

#### 3.3.3 Cleaning up the attribute table

We will now remove any unneeded fields for our analysis to keep the table tidy.

Right click the "population_buildings" layer and open its Attribute Table. Toggle editing mode by clicking the pencil icon in the top left of the attribute table window.

Once in editing mode, click the delete fields icon ![](https://lh7-us.googleusercontent.com/JZefrtGhdSOZw1ol4Dcz_iWi28QuDqCeifob-9DgYq3bQlCFRoc-DzIW6t4yvcIrmznWyE-C9HBRtnLxtD7mmpZHKy_xT7Labur9rRNp0YPpIObJ0VyPUOQmGdsbLdW8rKqW41J5TEjZbBWoQkK1gpc) . 

-   In the dialog window, select "code" and "fclass"

-   Click OK to delete these fields

Click the pencil icon again to save the changes.

#### 3.3.4 Converting building polygons into points

In this step, we will use the QGIS plugin realcentroid to convert the residential/apartment buildings into points that we will use in the next step.

-   Navigate to: Plugins \> Manage and Install Plugins... \> All \> Search for "realcentroid" \> Install Plugin

-   Navigate to: Vector \> realcentroid \> RealCentroid

    -   For the input fields:

        -   Polygon layer: QueryLayer

        -   Output point on surface layer:

    -   File name: population_buildings_points

    -   File location: data.shp

    -   Check the "Add to map canvas" box

![](https://lh7-us.googleusercontent.com/mzo3f0Im4WZJabeTKsyBJaseWpwzMb0j33ZVPUVoEaBqCzCsRWIJTHp8XJKrQul1skIxMF-yLhGIth1E_CtrKJfrpSSN4AJbiN1Kwfh2I8SspwO3lbIGzZJ7gryUq9mmoa2nTrzHeVPx9AeJcetJcD0)

#### 3.3.5 Presenting the information in a choropleth map

-   Navigate to: Vector \> Analysis Tools \> Count Points in Polygon...

    -   For the input fields:

        -   Polygons: Derna_city_250m_hexagon

        -   Points: population_buildings_points.shp

![](https://lh7-us.googleusercontent.com/Is2Ci-GBFGAieXKGOmBIdi4Q7Vedj3k5LXtnbeyXv5TmWbfppVbqEA1jljREu6GTnAsp1iLQyzlremtPQX3IyVCHTowy2Uyx-ZYorPks2NPtf030nXikjhtAmvNDRBV0bjQ7_9BpIy1oWdiT4PLvMcQ)

-   Click on "Run"

-   Following the steps shown previously, save the new layer as a GeoPackage in the "Derna '' GeoPackage and name it"population_density". 

-   Remove the "Count", "population_buildings_points.shp" and "Derna - population_buildings"  layers.

Now that we have the population_density field ready, we will use its values to create our choropleth map.

-   Navigate to: Layers Sidebar \> Right Click "Derna - population_density"\> Properties\> Symbology

    -   For the input fields:

        -   Change "Single Symbol" to "Graduated"

        -   Value: NUMPOINTS

        -   Mode: Natural Break (Jenks)

![](https://lh7-us.googleusercontent.com/UvPbmrtgSTvo3qPJaf0zBW36Kg8Abh2_TDwItkIPjUvAOEcYpcxLqezP76YRjOUgqn-IBD1gHM_ykXprBmjSIhc7BguvS7bDEo1yPgO1v8PkNNU-uuL4yb7iYvtaCIqknBNG5_vLHTKpLiUpD-KatPo)

-   Click on "OK"

#### 3.3.6 Adding a backdrop

In this part, we will be adding a backdrop to the map, so that an aerial map of Derna city can be used to make the map easily associable.

-   Navigate to: Layers Sidebar \> Right Click "Derna - population_density"\> Properties\> Symbology

    -   For the input fields:

        -   Opacity: 60%

-   Using 01_07_23 as a backdrop should make the map look like this:

![](https://lh7-us.googleusercontent.com/BapDfSbn_o-8et2ge_H_b5mlgibFP0yWLqeRAzcavGUCxWXttctGMPSMzgvkpzIo3s-BUIz9XA-PSFi-gCUZ9Fm3NETqkpjfMSICWGfCwmTLOc5QV7qNTiNfudVAAmV7y4ye2oWDDzi_lGPcokAE1ug)

## **DEM Sites Map**

## 3.4 Site Suitability of Evacuation Centres

Now we'll create the map to assess site suitability of the identified potential evacuation sites (schools and universities).

#### 3.4.1 Preparing the DEM layer

The DEM layer (n32_e022_1arc_v3) should be in your layers panel from the earlier steps. 

Since the DEM covers a larger area of Northern Africa, we will clip the DEM to our study area.

-   Navigate to: Raster \> Extraction \> Clip Raster by Mask Layer...

    -   For the input fields

        -   Input layer: n32_e022_1arc_v3

        -   Mask layer: Derna_city_250m_hexagon

        -   Target CRS: EPSG:3197 LGD2006 / Libya ™ Zone 12

We will now save the temporary clipped layer to our geopackage.

-   Navigate to: Layers Sidebar \> Right click "Clipped" 

-   Go to: Export \> Save Features As...

    -   For the input fields

        -   Format: GeoPackage

        -   File name: navigate to your project folder and double click your geopackage

        -   Layer Name: DEM_clipped

        -   CRS: EPSG:3197

<!-- -->

-   Click on "Ok"

-   Remove "n32_e022_1arc_v3" layer and the temporary "Clipped" layer

#### 3.4.2 Determining the flood extent

In the step, we will cut out the extent of the flood that affects Derna City

-   Navigate: Vector \> Geoprocessing Tools \> Clip...

    -   For the input fields

        -   Input layer: PHR_20230913_FloodExtent_Derna

        -   Overlay layer: Derna_city_250m_hexagon

![](https://lh7-us.googleusercontent.com/EqKB8g6T-r61BsCXLhnAAEifWH0-V3FNORe3IDSFNMHVBqtcPtBHEVsyqtliR25gplsba8vqGwY5br9sfOfIKlTK5ev4s-mvNn6kl_0qDICb0PunUapf4JFU2QYvt6wtqmz5CD-lDWxLY4rkHR5gf00)

-   Click on "Run"

-   Following the steps shown previously, save the new layer as a GeoPackage in the "Derna '' GeoPackage and name it"flood_extent". 

-   Remove the "PHR_20230913_FloodExtent_Derna" and "Clipped" layer.

-   Navigate: Layers Sidebar \> Right click "flood_extent" \> Properties \> Symbology

    -   Under "Fill" \> Left click "Simple Fill"

        -   Fill colour: "Transparent Fill"

        -   Stroke Width: 1

![](https://lh7-us.googleusercontent.com/yRAmTR3-mfIxUJ7vidQtB_Ff7Wi3DYhnotcA4fyE6RlxhNBwUgTaJDzk70V5swPBbqSABiItLziiYkFZ2ajT7fgmw_4O-sAkmeBYEVJrCKiE-H0cX9c2lAbrfEn6WhFEiS6SJp55ioncsrzeVWTPHGI)

o   Click "OK"

Following the steps in 3.3.3, keep only the fields listed and remove all other fields:

-   fid, Sensor_Dat, Area_m2, Area_ha, SHAPE_Leng, SHAPE_Area

\

#### 3.4.3 Extracting statistics from flood extent for ranking

We will use the flood extent polygon to analyse the statistics of the flood elevation levels reached. We will use the native Zonal Statistics function for this.

-   Navigate to: "Processing" from the top menu bar \> Toolbox

-   In the Processing Toolbox panel, search for "Zonal Statistics"

-   Double click on the Zonal Statistics function under Raster Analysis

    -   For the input fields

        -   Input layer: flood_extent

        -   Raster layer: DEM_clipped

        -   Under Statistics to calculate, click the three dots icon

            -   Select Mean, Median, Minimum, and Maximum

-   Click "OK"

Following the steps from 3.4.1, save the temporary Zonal Statistics layer into your "Derna" GeoPackage and name it "flood_zonal_statistics". Afterwards, remove the temporary Zonal Statistics layer.

We will quickly clean up the data table. Right click the "flood_zonal_statistics" layer and open its Attribute Table. 

-   Following the steps in 3.3.3, keep only the fields listed and remove all other fields:

    -   fid, Sensor_Dat, \_mean, \_median, \_min, \_max

Observing the summary statistics, take note of the median, mean and max values.

#### 3.4.4 Ranking the elevation levels by colour

We will now reflect the ranking of the elevation suitability using the summary statistics from the previous section.

-   Navigate to: Layers Sidebar \> Right Click "DEM_clipped" \> Properties \> Symbology

    -   For the input fields under Band Rendering:

        -   Render type: Singleband pseudocolor

        -   Edit the values as shown below:

            -   Orange - Median

            -   Yellow - Mean

            -   Green - Max

![](https://lh7-us.googleusercontent.com/T7rt9zBJE7Z-jJbbG0D6T12lA9ab28yCnp3tjxsjAEwkO_7Ok3KQ2gqdjXn4Au5nM_ReKn6yRnVXmPXvf_T13GxqHLmxpGcguOHG2QreUeQKDv1ZYkCC7L0LsAvm9MAs6gvYGELtr5nTqTRccf4OBMw)

-   Gamma: 0.50

<!-- -->

-   Once ready, click "Apply"

<!-- -->

-   In the Properties window, navigate to the Transparency tab

    -   Set Global Opacity to 70%

    -   Click "Apply"

#### 3.4.5 Extracting Evacuation Centres as points

We will be using the Points of Interest (POIs) shapefile from the OSM data for Libya. First, we will clip the data to our study area of the hexagon map. 

-   Navigate to: Vector \> Research Tools \> Select by Location...

    -   For the input fields

        -   Select features from: gis_osm_pois_a_free_1

        -   Where the features (geometric predicate): intersect

        -   By comparing to the features from: Derna_city_250m_hexagon

            -   Under Advanced options:

                -   Set invalid feature filtering: Do not Filter (Better Performance)

    -   Click "Run"

<!-- -->

-   Following the steps shown previously, save the new layer as a GeoPackage in the "Derna '' GeoPackage and name it"POIS ''. 

-   Remove the "gis_osm_pois_a_free_1"  layer. 

![](https://lh7-us.googleusercontent.com/YAl0JYQseseoir0zkmAZwB9M3SKQTwq6O8AduKP7IpATTZ2L4nL4rFbdYRZSnFW-8cBRSKHKqppIKA5QOAsOr-Xz-iWrD1_7-iDo-B9wx5NgEZ22BTE1zlxW_TuxRDWnDuhEPxpZDyniSCWyG08VIRE)

Now, we will find the schools and universities in the Derna city area. 

-   Navigate to: Layers Sidebar \> Right click "Derna - POIS" \> Open Attribute Table

-   From the Attribute Table:

    -   Click on "Select features using an expression" 

    -   For the input fields:

        -   Expression box:  "fclass"  =  'school' or  "fclass"  =  'university' 

-   Click on "Select Features"

-   Following the steps shown previously, save the selected features as a GeoPackage in the "Derna" GeoPackage and name it "evacuation_centres". 

We will then convert the polygons layer into a point layer.

Following the steps shown previously in 3.3.4, convert the evacuation_centres polygons into points using realcentroid. 

-   Save the resulting layer into the "Derna" GeoPackage and name it "evacuation_centres_points". 

-   Remove the "Centroids", "Derna - evacuation_centres", "Derna - POIS" and "gis_osm_pois_a_free_1" layers.

\

![](https://lh7-us.googleusercontent.com/hhBgUpqvpVir8TNF_9Jj0mNCA1sACkjRkyMrP0lkXwp3z6L4RByRY5aYo7sqFhwYMEsnV-iE2L4iX1GSPjtcUOWKe4dj-P4Tds5oa6rS28_Gi3DHDJVCb8vQSxkPy-kz2qSeHyfZyfnQ0ZDBrOcJ18c)

\

Following the steps in 3.3.3, keep only the fields listed and remove all other fields:

-   id, osm_id, fclass, name

\

#### 3.4.6 Separating the Viable and Non-viable Evacuation Centres

Referencing the colour-ranked DEM layer, we will separate the viable and non-viable sites from the "evacuation_centres_points" layer.

\

##### 3.4.6.1 Extracting the Non-Viable Sites

We will select out the evacuation centres that fall within the higher risk areas of flooding (the red-yellow colours) based on visual reference.

-   Navigate to: Toolbar \> Select Features by Polygon ![](https://lh7-us.googleusercontent.com/4KEfcuvNOU_DJhYDBSjIXg8kfVyPGMFATK97_bQMTJRD-ip95DlQ-_Z_7xK-tgpj_l11YaTwwtSYausXikXyb6xQbwmag4RQMyEuGaWj90lrQDhyb6lgiNj7W-vMP3eQLYTzl3EwYKsE9HSjrtcJBUA)

    -   Make sure the "evacuation_centres_points" layer is selected in the Layers Panel.

    -   Draw a rough polygon that selects all the points that fall within red-coloured to yellow-coloured areas, using left mouse clicks to create the points of the polygon.

    -   Right click to confirm the selection of features within the shape drawn.

![](https://lh7-us.googleusercontent.com/gmiKlCmrMvSoGZX9Cru29pexw3lFvhBGkXEFoeWjOc9lgzzUtjH3M20U0FVtYATp0MuGOpFIGIFz4Nck2lVGF_OgPkvtqc555jtgidN_Jh1bAbxKmcfHm5Py8XgA9TfIQqPDOOEIJakv4KJ6tXaHQG4)

Following the steps in 3.3.1, save the selected points into your geopackage as "Non-viable School Sites". 

-   Rename the new layer in the Layers panel to remove the name of the geopackage for tidiness.

\

##### 3.4.6.2 Adding the symbol for Non-viable Sites

To indicate that these initial sites are no longer considered, we will change the point symbol to a cross icon.

-   Navigate to: Layers Sidebar \> Right Click "Non-viable School Sites" \> Properties \> Symbology

    -   Under Marker, click Simple Marker

        -   For input fields:

            -   Symbol layer type: SVG Marker

            -   SVG Image: ![](https://lh7-us.googleusercontent.com/ZjS9C9E5WiL5Woa7fCYlpHFL-Pklph5V1OkPBSmS0-AzKKxwUxWt0ndGBL6qnuJE39h2ekpaSgBe98LwAoZE5kmbHjVpuEZqOafl8y-MtL-jBipOWcB5KjkT8zb1zHtGJ-8zlJrITUeI_bFBaF3uUns)

            -   Size: 5.50 Millimetres

            -   Rotation: 45º

            -   Fill colour: Teal (HTML notation: #00ffde)

                -   Choose a colour that will stand out against the red-yellow colours of the DEM layer

            -   Stroke colour: Black (HTML notation: #000000)

            -   Stroke Width: 0.20 Millimetres

    -   Feel free to change the colours as you wish

\

##### 3.4.6.3 Extracting the Viable Sites

We will now select the remaining evacuation centres which should fall within the lower risk areas of flooding (the green-blue colours).

-   Navigate to: Toolbar \> Select Features by Polygon ![](https://lh7-us.googleusercontent.com/4KEfcuvNOU_DJhYDBSjIXg8kfVyPGMFATK97_bQMTJRD-ip95DlQ-_Z_7xK-tgpj_l11YaTwwtSYausXikXyb6xQbwmag4RQMyEuGaWj90lrQDhyb6lgiNj7W-vMP3eQLYTzl3EwYKsE9HSjrtcJBUA)

    -   Make sure the "evacuation_centres_points" layer is selected in the Layers Panel.

    -   Draw a rough polygon that selects all the remaining points, using left mouse clicks to create the points of the polygon.

    -   Right click to confirm the selection of features within the shape drawn.

![](https://lh7-us.googleusercontent.com/gx94f-Kv0nw_i2CfP3_un4KE1sANvE7KI3gYBGofDNDa6PYiWZFZhW0WZsp158WbwZGN_gBvWMHj3YkC4AwV989CZfgw2STOuyoaolOGYSJlJxBwnlEbJGYo88c3y6IW5GKwzwZr6Lx6ObwY3XYDHrw)

Following the steps in 3.3.1, save the selected points into your geopackage as "Viable School Sites". 

-   Rename the new layer in the Layers panel to remove the name of the geopackage for tidiness.

\

##### 3.4.6.4 Adding the symbol for Viable Sites

To indicate that these sites are suitable evacuation centres, we will change the point symbol to a shelter icon.

-   Navigate to: Layers Sidebar \> Right Click "Viable School Sites" \> Properties \> Symbology

    -   Under Marker, click Simple Marker

        -   For input fields:

            -   Symbol layer type: SVG Marker

            -   SVG Image: ![](https://lh7-us.googleusercontent.com/wx6Z0gru5dvcQq6t2U8GJ0J8AQ_lBqFVZK3vB5aVaxe97eDPrlMKvmX_RhgkYiUnKkNoykOkwVVe5-01TnksqF5I_KZGM_R20nmFAmEJOKmgEqel0viFc7bq2sz-9DIX0SMWLcx_1OeRKNT54in2oAA)

            -   Size: 8.00 Millimetres

            -   Fill colour: White (HTML notation: #ffffff)

            -   Stroke colour: Blue (HTML notation: #0006c0)

            -   Stroke Width: 0.30 Millimetres

            -   Under Offset, y: -2.0 Millimetres

    -   Feel free to change the colours as you wish, but do ensure these icons visually distinct from the cross icons in colour

From the Layers panel, uncheck the "evacuation_centres_points" layer to hide its visibility. Your map should look something like this:

![](https://lh7-us.googleusercontent.com/BwAfNyjViuU6R02PPf4L91_tHxk32QBO5MzcyOxsD4UsY3oySclhopm-mJTsY3Q1FDtcGtztJXr4JP0rYUxq8SmvTpyai1lTL1_vCZSAQ_U-868ol-q_7NlwxcjB3mf46dmZQD9mP1ZvsQx38EY5gao)

\

#### 3.4.7 Adding the Satellite View Backdrop

We will be adding a backdrop to the map, so that an aerial map of Derna city can be used to make the map easily associable.

-   Using 13_09_23_clipped as a backdrop should make the map look like this:

![](https://lh7-us.googleusercontent.com/bJKqo7tVperVIq2VYtksewWJOHVp2aBpCS1yPvxrukq8QPUbq6ymq9D9My0xz7KIQwFLPhVsQbjiwS9rGhoX9mYR8oiTD3EYepbhMWsq8rqFhkJB0C-fFH6EDDRYetIY3eY5xlOcqCYmQ2n89o8emJk)

## **Accessibility Choropleth**

3.5 Accessibility analysis

In this part, we will be analysing the accessibility of health facilities and evacuation centres in Derna city.
